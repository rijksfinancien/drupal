var rijksTreemap=function(a,b){var c,d;if(!a.d3)throw"rijksTreemap needs d3.js V4";if(c=a.d3,a.jQuery)d=a.jQuery;else{if(!a.$)throw"rijksTreemap needs jQuery";d=a.$}var e=function(){var b=null,e=!1,f=null,g=!1,h="rijks-treemap",i=function(a,b){return b===!0?"."+h+"-"+a:h+"-"+a},j=function(){var a=function(a,b){f.selections[a].items.forEach(function(c){c.label===b&&f.selections[a].items.forEach(function(a){a.isActive=a.label===b?!0:!1})})},b=function(b){"string"==typeof b&&b.length&&(c.leaves().forEach(function(a){a.data.labelShort===b&&o(a)}),a("years",b),a("categories",b))};try{var c=s(f),d=window.location.hash;if("string"==typeof d&&d.length){var e=d.match(/treemap=([0-9A-Za-z\,\- ]+)/);if(e&&"string"==typeof e[1]&&e[1].length){var g=e[1].split(",").slice(0,3);g.forEach(function(a){b(a)})}}}catch(h){console.error("Error parsing the url",h)}},k=function(a){var b=new RegExp("^https://");return"string"==typeof a&&b.test(a)?a:!1},l=function(){var a=0;return f.children.forEach(function(b){b.isActive&&1>a&&(a=1),b.children.forEach(function(b){b.isActive&&(a=2)})}),a},m=function(a){var b=1e3,c=null;return function(){var d=this;clearTimeout(c),c=setTimeout(function(){a.apply(d)},b)}};d(a).resize(m(function(){w()}));var n=function(a){if(!a.dataset)throw"Dataset is not defined";var b=p("categories"),c=p("years");if(!b||!c)throw"Selections are not set";for(var d=0;d<a.dataset.length;d++){var e=a.dataset[d];if(b.label===e[0]&&c.label===e[1])return e[2]}return!1},o=function(a){var b=s(f),c=a.data.isActive;b.children.concat(b.leaves()).forEach(function(a){a.data.isActive=!1}),c||(a.data.isActive=!0),2===a.depth&&(a.parent.data.isActive=!0)},p=function(a){if("years"!==a&&"categories"!==a)throw"Str should be years or categories";var b=null;return f.selections[a].items.forEach(function(a){a.isActive&&(b=a)}),b},q=function(a,b){var d=p("categories"),e=d.decimals,f=c.formatLocale({decimal:",",thousands:".",grouping:[3]}).format(",."+e.toString()+"f");if("number"!=typeof e)return console.error("Number of decimals must be a number"),"?";if("string"!=typeof a&&null!==a&&a!==!1)return console.error("Not a good number for formatting: "+a),"?";if(null===a)return"-";if(a===!1)return"";var g=f(a);return b===!0?d.format.replace("{{value}}",g):g},r=function(){var a=s(f);e&&j();var c=b,h=c.append("div").attr("class",i("menu")).html('<div class="'+i("row")+'"><div class="'+i("column")+'"></div><div class="'+i("column")+'"></div></div>'),k=h.select(i("row",!0)).select(i("column",!0)+":first-child"),m=h.select(i("row",!0)).select(i("column",!0)+":last-child"),n=k.append("div").attr("class",i("autocomplete")).html('<input type="text" placeholder="Zoek agentschap of departement"><div></div>');n.select("input").on("click",function(){d(this).select()}).on("keyup",function(){var a=s(f),b=this.value.toLowerCase(),c=[],d=function(a){var c=[];return a.forEach(function(a){b.length&&(a.data.label&&a.data.label.toLowerCase().indexOf(b)>-1||a.data.labelShort&&a.data.labelShort.toLowerCase().indexOf(b)>-1)&&c.push(a)}),c};c=c.concat(d(a.children)).concat(d(a.leaves())).slice(0,8);var e=n.select("div").selectAll("div").data(c,function(a){return a.data.label}),g=e.enter().append("div").html("<span></span><span></span>").classed(i("active"),function(a){return a.activeValue!==!1}).on("click",function(a){a.activeValue!==!1&&(a.data.scrollTo=!0,o(a),w(),n.select("div").selectAll("div").remove())});g.select("span:first-child").text(function(a){return a.data.label+" ("+a.data.labelShort+")"}),g.select("span:last-child").text(function(a){return"Geen gegevens in "+p("years").label}),e.exit().remove()}),k.append("button").text("Diagram").on("click",function(){g=!g,g&&2===l()&&a.children.forEach(function(a){a.children.forEach(function(a){a.data.isActive&&(o(a),w())})}),w()}),[["category","categories"],["year","years"]].forEach(function(a){m.append("select").attr("class",a[0]).on("change",function(){var b=this.value;f.selections[a[1]].items.forEach(function(a){a.isActive=b===a.label?!0:!1}),w()})});var q=c.append("div").attr("class",i("row")+" "+i("row-responsive"));q.append("div").attr("class",i("column")).append("div").attr("class",i("dropdowns"));var m=q.append("div").attr("class",i("column")),r=m.append("svg").attr("class",i("chart"));r.append("g").attr("class",i("children")),r.append("g").attr("class",i("parents"));m.append("div").attr("class",i("tooltip")).html("<div></div><div></div>");w()},s=function(a){return c.hierarchy(a).sum(function(a){return a.dataset?n(a):void 0}).eachBefore(function(a){!a.data.color&&a.parent&&(a.data.color=c.color(a.parent.data.color).darker()),a.data.dataset?a.activeValue=n(a.data):a.activeValue=a.value.toFixed(8)}).sort(function(a,b){return b.height-a.height||b.value-a.value})},t=function(a,c){var d=b.select(i("menu",!0)).select(a).selectAll("option").data(c,function(a){return a.label});d.enter().append("option").text(function(a){return a.label}).merge(d).property("selected",function(a){return a.isActive?!0:!1}),d.exit().remove()},u=function(a,b){var c=a.selectAll(function(){return this.childNodes}).data(function(a){return a.children.filter(function(a){return a.activeValue!==!1})},function(a){return a.data.label}),e=c.enter().append("div").attr("class",i("panel")).html('<div class="'+i("panel-header")+'"><span class="'+i("icon")+'"></span><span class="'+i("label")+'"><span></span><span></span></span></div><div style="display: none" class="'+i("panel-body")+'"></div>');e.select(i("panel-body",!0)).html(b),e.select(i("panel-header",!0)).on("click",function(a){o(a),w()}).select(i("icon",!0)).attr("class",function(a){var b=new RegExp("^[0-9]{4}$");return"string"==typeof a.data.icon&&4===a.data.icon.length&&b.test(a.data.icon)?i("icon")+" "+i("icon")+"-"+a.data.icon:i("icon")}).style("background-color",function(a){return a.data.color}),c.exit().remove();var f=e.merge(c);return f.order().each(function(a){var b=this;a.data.scrollTo===!0&&(a.data.scrollTo=!1,setTimeout(function(){d("html, body").animate({scrollTop:d(b).offset().top},500)},250));var c=d(this).children(i("panel-body",!0)),e=c.is(":visible");a.data.isActive&&!e?c.finish().slideDown(250):!a.data.isActive&&e&&c.finish().slideUp(250)}).select(i("panel-header",!0)).style("background-color",function(a){return a.data.isActive?a.data.color:null}).style("color",function(a){return a.data.isActive?"#FFF":null}),f.select(i("label",!0)).select("span:first-child").text(function(a){return a.data.label}),f.select(i("label",!0)).select("span:last-child").text(function(a){return q(a.activeValue,!0)}),f},v=function(a,b,e,f,g){var h=d(b.node().parentNode),j=c.scaleLinear().domain([0,h.width()]).range([0,h.width()]),k=c.scaleLinear().domain([0,h.height()]).range([0,h.height()]);a.children.forEach(function(a){a.data.isActive&&(j.domain([a.x0,a.x1]),k.domain([a.y0,a.y1]))});var m=function(a){return"translate("+j(a.x0)+","+k(a.y0)+")"},n=function(a){return j(a.x1)-j(a.x0)},p=function(a){return k(a.y1)-k(a.y0)},r=b.selectAll("g.child").data(e,function(a){return a.data.labelShort}),s=c.select(b.node().parentNode.parentNode).select(i("tooltip",!0)),t=function(a){2===a.depth&&(a.data.scrollTo=!0),o(a),w()},u=r.enter().append("g").attr("transform",m).attr("class","child").style("cursor","pointer").on("mouseenter",function(a){var b=a.data.wasTapped&&Date.now()-a.data.wasTapped<600;return b?void t(a):void(g?c.select(this).attr("opacity",0):(s.style("display","block"),s.select("div:first-child").text(a.data.label),s.select("div:last-child").text(q(a.activeValue,!0))))}).on("mouseleave",function(){g?c.select(this).attr("opacity",1):s.style("display","none")}).on("mousemove",function(){var a=c.mouse(this.parentNode),b=d(s.node()),e=b.outerWidth(!0),f=d(this).closest("svg").width(),g=a[0];g>f-.5*e&&(g=f-.5*e),.5*e>g&&(g=.5*e),s.style("left",g+"px").style("top",a[1]+"px")}).on("click",t).on("touchend",function(a){a.data.wasTapped=Date.now()});u.append("rect").attr("width",n).attr("height",p),u.append("text").attr("fill","#FFF").attr("text-anchor","middle").attr("dy","0.34em"),u.merge(r).attr("visibility",function(){return f?"visible":"hidden"}).transition().attr("transform",m).select("rect").attr("width",n).attr("height",p).attr("fill",function(a){if(2===a.depth){var b=c.color(a.parent.data.color);return 2===l()&&a.data.isActive?b.darker():b}return a.data.color}),u.merge(r).select("text").text(function(a){var b=j(a.x1)-j(a.x0),d=k(a.y1)-k(a.y0),e=c.select(this);return e.text(a.data.label),this.getBBox().height>=d?"":this.getBBox().width<b?a.data.label:(e.text(a.data.labelShort),this.getBBox().width<b?a.data.labelShort:"")}).transition().attr("x",function(a){return.5*(j(a.x1)-j(a.x0))}).attr("y",function(a){return.5*(k(a.y1)-k(a.y0))}),r.exit().remove()},w=function(){2===l()&&(g=!1);var a=d(b.node()).width(),e=800>a;b.classed(i("small-mode"),e).classed(i("show-chart"),g);var h=b.select(i("row",!0));rowWidth=d(h.node()).width(),b.select(".menu button").style("display",function(){return e?"inline-block":"none"});var j=d(i("column",!0)).last().width(),m=550,n=s(f),o=b.select(i("chart",!0)).style("width",j+"px").style("height",m+"px"),r=c.treemap().tile(c.treemapResquarify).size([j,m]).round(!1).paddingInner(1);r(n),v(n,o.select(i("children",!0)),n.leaves(),!0,!1),v(n,o.select(i("parents",!0)),n.children,0===l(),!0),t("select.category",f.selections.categories.items),t("select.year",f.selections.years.items);var w=u(b.select(i("dropdowns",!0)).datum(n),null),x=u(w.select(i("panel-body",!0)),'<ul></ul><i></i><div class="'+i("bar-chart")+'"><div class="'+i("tooltip")+'"><div></div></div><svg><g><g class="'+i("x-axis")+'"></g><g class="'+i("y-axis")+'"></g><g class="'+i("bars")+'"></g></g></svg></div>');x.select("i").text(function(a){var b=p("categories");return b&&b.unit?b.unit:""});var y=x.select(i("panel-body",!0)).select("ul").selectAll("li").data(function(a){return a.data.bullets});y.enter().append("li").each(function(a){var b=c.select(this);"string"==typeof k(a)?b.append("a").attr("target","_blank").attr("href",a).text("Link"):b.append("span").text(a)}),y.exit().remove();x.filter(function(a){return a.data.isActive?!0:!1}).each(function(a){var b=d(this).width(),e=175,f=p("categories"),g=c.select(this).select(i("bar-chart",!0)).select("svg"),h=c.select(this).select(i("tooltip",!0)),j=a.data.dataset.filter(function(a){return f&&a[0]===f.label}),k=c.max(j,function(a){return parseFloat(a[2])}),l=c.scaleBand().rangeRound([0,b]).padding(.1),m=c.scaleLinear().rangeRound([e,0]);l.domain(j.map(function(a){return a[1]}).sort(function(a,b){return a-b})),m.domain([0,k]);var n=c.formatLocale({decimal:",",thousands:".",grouping:[3]}),o=0;g.select(i("y-axis",!0)).call(c.axisLeft(m).ticks(4).tickFormat(n.format(","))).selectAll(".tick").each(function(){o=Math.max(o,this.getBBox().width)}),g.select("g").attr("transform","translate("+o+", 5)"),l.rangeRound([0,b-o-.5*l.bandwidth()]),g.select(i("x-axis",!0)).attr("transform","translate(0,"+e+")").call(c.axisBottom(l).tickFormat(function(a){return"'"+a[2]+a[3]})),g.select(i("bars",!0)).attr("fill",a.data.color);var r=g.select(i("bars",!0)).selectAll("rect").data(j);r.enter().append("rect").merge(r).attr("x",function(a){return l(a[1])}).attr("width",l.bandwidth()).attr("y",function(a){return m(a[2])}).attr("height",function(a){return e-m(a[2])}).on("mouseenter",function(a){h.style("display","block"),h.select("div").text(q(a[2],!0))}).on("mouseleave",function(){h.style("display","none")}).on("mousemove",function(){var a=c.mouse(this.parentNode.parentNode.parentNode),b=d(h.node()),e=b.outerWidth(!0),f=d(this).closest("svg").width(),g=a[0];g>f-.5*e&&(g=f-.5*e),.5*e>g&&(g=.5*e),h.style("left",g+"px").style("top",a[1]+"px")}),r.exit().remove();var s=g.select(i("bars",!0)).selectAll("text").data(function(){return j.filter(function(a){return 0===parseFloat(a[2])||null===a[2]})});s.enter().append("text").attr("x",function(a){return l(a[1])+.5*l.bandwidth()}).attr("y",function(a){return m(a[2])}).attr("dy","-0.64em").attr("text-anchor","middle").text(function(a){return q(a[2])})})};return{init:function(a,g,h){if(!a||"string"!=typeof a&&!a.nodeType)throw"Missing element argument. RijksTreemapWidget.init() needs a string or DOM element as first argument";if(!g||"string"!=typeof g&&!jQuery.isPlainObject(g))throw"Missing data argument. RijksTreemapWidget.init() needs a string or object as second argument";b=c.select(a).classed("rijks-treemap",!0),jQuery.isPlainObject(h)&&"boolean"==typeof h.parseUrl&&(e=h.parseUrl),"string"==typeof g?d.ajax({dataType:"json",url:g,cache:!1,success:function(a){f=a,r()},error:function(){throw"RijksTreemapWidget could not load JSON data from "+g}}):(f=g,r())}}};return{create:function(){return e()}}}(window,document);